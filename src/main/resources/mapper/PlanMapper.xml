<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ksmart42.khtour.mapper.PlanMapper">

   <resultMap type="Plan" id="planResultMap">
      <id column="plan_code" 				property="planCode"/>                 <!-- 여행계획 코드 -->
      <result column="member_id" 			property="memberId"/>                 <!-- 등록자 아이디 -->
      <result column="plan_name"		 	property="planName"/>                 <!-- 여행 명 -->
      <result column="start_date" 			property="startDate"/>                <!-- 여행 시작일 -->
      <result column="end_date"				property="endDate"/>                  <!-- 여행 종료일 -->
      <result column="solo_party" 			property="soloParty"/>                <!-- 개인/단체 구분 -->
      <result column="plan_materials" 		property="planMaterials"/>            <!-- 여행 준비물 -->
      <result column="plan_expenses" 		property="planExpenses"/>             <!-- 여행 총 경비 -->
      <result column="plan_location"		property="planLocation"/>             <!-- 여행 지역 -->
      <result column="reg_date"				property="regDate"/>             	  <!-- 등록 날짜 -->
   </resultMap> 
   
   <!-- 여행계획 목록 조회 SQL -->
   <select id="getPlanList"  resultMap="planResultMap">
      SELECT
        p.plan_code
         ,p.member_id
         ,p.plan_name
         ,p.start_date  
         ,p.end_date    
         ,p.solo_party
         ,p.plan_materials   
         ,p.plan_expenses   
         ,p.plan_location
         ,p.reg_date    
      FROM
        tb_tra_plan AS p
   	<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="memberId != null and memberId != ''">
				h.member_id = #{memberId}
			</if>
			<if test="searchKey != null and searchKey != '' and searchValue != ''">
		 		AND ${searchKey} LIKE CONCAT('%', #{searchValue}, '%')
		 	</if>
	</trim>
	ORDER BY p.plan_code;	
   </select>
   
   <!-- 코드에 따른 여행계획 조회 SQL -->
   <select id="getPlanByCode" parameterType="String" resultMap="planResultMap">
      SELECT
          p.plan_code
         ,p.member_id
         ,p.plan_name
         ,p.start_date 
         ,p.end_date  
         ,p.solo_party
         ,p.plan_materials   
         ,p.plan_expenses   
         ,p.plan_location 
         ,p.reg_date     
      FROM
        tb_tra_plan AS p
      WHERE
         plan_code = #{planCode};
   
   </select>
   
   <!-- 여행계획 등록 SQL -->
   <insert id="addPlan" parameterType="Plan">
      INSERT INTO tb_tra_plan
      (   plan_code
         ,member_id
         ,plan_name
         ,start_date 
         ,end_date 
         ,solo_party
         ,plan_materials   
         ,plan_expenses   
         ,plan_location
         ,reg_date              
      ) VALUES (
         sf_new_plan_code()
         ,#{memberId}
         ,#{planName}
         ,#{startDate}
         ,#{endDate}
         ,#{soloParty}
         ,#{planMaterials}
         ,#{planExpenses}
         ,#{planLocation}
         ,CURDATE()
      );
   
   </insert>

   <!-- 여행계획 정보 수정 SQL -->
      <update id="modifyPlan" parameterType="Plan">
      UPDATE tb_tra_plan
      <trim prefix="SET" suffixOverrides=",">
         <if test="planName != null and planName != ''">
            plan_name = #{planName},
         </if>
         <if test="startDate != null and startDate != ''">
            start_date = #{startDate},
         </if>
         <if test="endDate != null and endDate != ''">
            end_date = #{endDate},
         </if>
         <if test="soloParty != null and soloParty != ''">
            solo_party = #{soloParty},
         </if>
         <if test="planMaterials != null and planMaterials != ''">
            plan_materials = #{planMaterials},
         </if>
         <if test="planExpenses != null and planExpenses != ''">
            plan_expenses = #{planExpenses},
         </if>      
         <if test="planLocation != null and planLocation != ''">
            plan_location = #{planLocation},
         </if>            
      </trim>
      WHERE
         plan_code = #{planCode};
   </update>
   
   <!-- 여행계획 정보 삭제 SQL -->
   <delete id="removePlan" parameterType="String">
      DELETE
      FROM
         tb_tra_plan
      WHERE
         plan_code = #{planCode};
   </delete>
</mapper>