<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ksmart42.khtour.mapper.MusMapper">
	<resultMap type="Mus" id="musResultMap">
		<id column="mus_code" 					property="musCode" />
		<result column="mus_large_cate_code" 	property="musLargeCateCode" />
		<result column="mus_large_cate_name" 	property="musLargeCateName" />
		<result column="mus_name" 				property="musName" />
		<result column="mus_addr" 				property="musAddr" />
		<result column="mus_detail" 			property="musDetail" />
		<result column="mus_site" 				property="musSite" />
		<result column="mus_num" 				property="musNum" />
		<result column="mus_disclose" 			property="musDisclose" />
		<result column="mus_start" 				property="musStart" />
		<result column="mus_end" 				property="musEnd" />
		<result column="mus_close" 				property="musClose" />
	</resultMap>

	<!-- 박물관 등록 SQL -->
	<insert id="addMus" parameterType="Mus">
		INSERT INTO tb_mus_info
		(
		 mus_code
		,mus_large_cate_code
		,mus_large_cate_name
		,mus_name
		,mus_addr
		,mus_detail
		,mus_site
		,mus_num
		,mus_disclose
		,mus_start
		,mus_end
		,mus_close
		) VALUES (
		sf_new_mus_code()
		,#{musLargeCateCode}
		,#{musLargeCateName}
		,#{musName}
		,#{musAddr}
		,#{musDetail}
		,#{musSite}
		,#{musNum}
		,#{musDisclose}
		,#{musStart}
		,#{musEnd}
		,#{musClose}
		);
	</insert>
	
	<!-- 박물관명 중복 체크 -->
   <select id="isNameCheck" parameterType="String" resultType="boolean">
      SELECT
         IF(COUNT(1) = 1, 0, 1)
      FROM 
         tb_mus_info AS m
      WHERE 
         m.mus_name = #{musName};
   </select>
	
	<!-- 코드에 따른 전시회 조회 SQL -->
	<select id="getMusByCode" parameterType="String" resultMap="musResultMap">
		SELECT
		 m.mus_code
		,m.mus_large_cate_code
		,m.mus_large_cate_name
		,m.mus_name
		,m.mus_addr
		,m.mus_detail
		,m.mus_site
		,m.mus_num
		,m.mus_disclose
		,m.mus_start
		,m.mus_end
		,m.mus_close
		FROM
		tb_mus_info AS m
		WHERE
		mus_code = #{musCode};
	</select>

	<!-- 전시회 목록 조회 SQL -->
	<select id="getMusList" resultMap="musResultMap">
		SELECT
		 m.mus_code
		,m.mus_large_cate_code
		,m.mus_large_cate_name
		,m.mus_name
		,m.mus_addr
		,m.mus_detail
		,m.mus_site
		,m.mus_num
		,m.mus_disclose
		,m.mus_start
		,m.mus_end
		,m.mus_close
		FROM
		tb_mus_info AS m
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="searchKey != null and searchKey != '' and searchValue != ''">
		 		AND ${searchKey} LIKE CONCAT('%', #{searchValue}, '%')
		 	</if>
		</trim>
		ORDER BY m.mus_code;	
	</select>

	<!-- 전시회 수정 SQL -->
	<update id="modifyMus" parameterType="Mus">
		UPDATE tb_mus_info
		<trim prefix="SET" suffixOverrides=",">
			<if test="musLargeCateCode != null and musLargeCateCode != ''">
				mus_large_cate_code = #{musLargeCateCode},
			</if>
			<if test="musLargeCateName != null and musLargeCateName != ''">
				mus_large_cate_name = #{musLargeCateName},
			</if>
			<if test="musName != null and musName != ''">
				mus_name = #{musName},
			</if>
			<if test="musAddr != null and musAddr != ''">
				mus_addr = #{musAddr},
			</if>
			<if test="musDetail != null and musDetail != ''">
				mus_detail = #{musDetail},
			</if>
			<if test="musSite != null and musSite != ''">
				mus_site = #{musSite},
			</if>
			<if test="musNum != null and musNum != ''">
				mus_num = #{musNum},
			</if>
			<if test="musDisclose != null and musDisclose != ''">
				mus_disclose = #{musDisclose},
			</if>
			<if test="musStart != null and musStart != ''">
				mus_start = #{musStart},
			</if>
			<if test="musEnd != null and musEnd != ''">
				mus_end = #{musEnd},
			</if>
			<if test="musClose != null and musClose != ''">
				mus_close = #{musClose},
			</if>
		</trim>
		WHERE
			mus_code = #{musCode};
	</update>

	<!-- 전시회 정보 삭제 SQL -->
	<delete id="removeMus" parameterType="String">
		DELETE
		FROM
			tb_mus_info
		WHERE
			mus_code = #{musCode};
	</delete>
</mapper>