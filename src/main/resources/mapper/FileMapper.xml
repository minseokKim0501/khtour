<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ksmart42.khtour.mapper.FileMapper">
   <resultMap type="FileDto" id="fileResultMap">
      <result property="fileIdx"          column="file_idx"/>
      <result property="fileNewName"       column="file_new_name"/>
      <result property="fileOriginalName" column="file_original_name"/>
      <result property="filePath"       column="file_path"/>
      <result property="fileSize"       column="file_size"/>
   </resultMap>
   
   <insert id="addFile" parameterType="list">
      INSERT INTO tb_file
      (
          file_idx
         ,file_new_name
         ,file_original_name
         ,file_path
         ,file_size
      )VALUES
      <foreach collection="list" item="data" separator=",">
      ( 
          #{data.fileIdx}
         ,#{data.fileNewName}
         ,#{data.fileOriginalName}
         ,#{data.filePath}
         ,#{data.fileSize}
      )
      </foreach>
   </insert>
   
   <insert id="addFileControl" parameterType="list">
      INSERT INTO tb_file_control
      (
          reference_code
         ,file_idx
         ,file_path
      )VALUES
      <foreach collection="list" item="data" separator=",">
      ( 
          #{data.referenceCode}
         ,#{data.fileIdx}
         ,#{data.filePath}
      )
      </foreach>
   </insert>
   
   <select id="getFileList" resultMap="fileResultMap">
      SELECT
          file_idx
         ,file_new_name
         ,file_original_name
         ,file_path
         ,file_size
      FROM
         tb_file
   </select>

   <select id="getFileInfoByIdx" parameterType="string" resultMap="fileResultMap">
      SELECT
          file_idx
         ,file_new_name
         ,file_original_name
         ,file_path
         ,file_size
      FROM
         tb_file
      WHERE
         file_idx = #{fileIdx}
   </select>
   
   <delete id="removeFile" parameterType="String">
      DELETE 
      FROM 
         tb_file
      WHERE 
         file_idx = #{fileIdx};
   </delete>
    <delete id="removeFileByFilePath" parameterType="String">
      DELETE 
      FROM 
         tb_file
      WHERE 
         file_path = #{filePath};
   </delete>
   
   <delete id="removeFileControl" parameterType="String">
      DELETE 
      FROM 
         tb_file_control
      WHERE 
         file_idx = #{fileIdx};
   </delete>
   <delete id="removeFileControlByFilePath" parameterType="String">
      DELETE 
      FROM 
         tb_file_control
      WHERE 
        file_path = #{filePath};
   </delete>
</mapper>